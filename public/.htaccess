<IfModule mod_rewrite.c>
  RewriteEngine On

  # Why: hosting is static; we rely on rewrites to serve SSG pages and keep clean URLs.
  # This file is copied to `dist/.htaccess` during build (see `scripts/generate-sitemap.mjs`).

  # Avoid content-negotiation surprises (e.g. /cv -> /cv.*)
  <IfModule mod_negotiation.c>
    Options -MultiViews
  </IfModule>

  # Redirect explicit /index.html -> /
  RewriteRule ^index\.html$ / [R=301,L]

  # Redirect *.html -> without extension (301), only for real client requests
  RewriteCond %{THE_REQUEST} \s/([^\s?]+?)\.html(?:[\s?]|$) [NC]
  RewriteRule ^ %1 [R=301,L]

  # Normalize URLs to always include a trailing slash (301) for directory-like paths.
  # Examples:
  # - /posts -> /posts/
  # - /posts/some-slug -> /posts/some-slug/
  # Note: exclude real files (favicon.ico, sitemap.xml, assets, etc.).
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_URI} !\.[^./]+$ [NC]
  RewriteCond %{REQUEST_URI} !/$
  RewriteRule ^(.+)$ $1/ [R=301,L]

  # Serve pre-rendered SSG pages: /cv or /cv/ -> /cv/index.html (internal rewrite)
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} -d
  RewriteCond %{REQUEST_FILENAME}/index.html -f
  RewriteRule ^(.+?)/?$ $1/index.html [L]

  # SPA fallback
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteRule . /index.html [L]
</IfModule>
